+++
title = '以数据为中心的分层实践（FastAPI + SQLModel + Alembic SOP）'
date = 2025-08-23T08:00:00+12:00
draft = true
tags = ["DTO", "DAO", "FastAPI", ""]
description = "面向中小型到企业级后端的可维护、可演进、可测试分层方案。技术栈：FastAPI + SQLModel（Pydantic v2）+ Alembic。"
+++

实际上都能通过某中规则生成。那么LLM到底给我们带来了什么？主要是帮助我更快的思考。
代码文件结构和实际分层结构是2回事儿

进一步解释gap：将商业API连接在一起，创造新的API填补gap

# 1 标准结构与职责（从“数据”视角切入）
运行时调用链
> router → service → dao → model（→ DB）

```
图例：
──→   实时调用（runtime call）
- -→  类型/契约引用（compile-time/type usage）
<~>   映射/投影（Model ↔ DTO，非调用）

┌───────────────┐                                       ┌──────────────────────┐
│   HTTP JSON   │                                       │     DTO / Schemas    │
└───────┬───────┘                                       │  传输契约 / 校验模型    │
        │ 请求/响应                                     └─────────┬────────────┘
        ▼                                                        ▲
┌─────────────────────┐              - - - - - - - - - - - - - - │  Router 使用 DTO
│       Router        │ - - - - - - - - - - - - - - - - - - - -→ │  进行请求校验 &
│  鉴权 / 入参校验 /  │                                            │  响应投影（必选）
│  response_model     │                                          │
└─────────┬───────────┘                                          │
          │ ──→ 实时调用                                          │
          ▼                                                      │
┌─────────────────────┐             - - - - - - - - - - - - - - -│  Service 可选
│       Service       │ - - - - - - - - - - - - - - - - - - - -→ │  使用 DTO 类型
│  业务编排 / 事务     │                                           │  （强类型/省胶水）
│  DTO→Model 映射      │                                          │
└─────────┬───────────┘                                          │
          │ ──→ 实时调用                                          │
          ▼                                                      │
┌─────────────────────┐                                          │
│         DAO         │   ✕──────────────────────────────────────┘  （DAO 禁止依赖 DTO）
│  纯数据访问（Session+Model）│
└─────────┬───────────┘
          │ ──→ ORM 映射
          ▼
┌─────────────────────┐              <~>（映射/投影：双向）
│        Model        │ <───────────────────────────────────────────> DTO / Schemas
│  SQLModel / SA ORM  │
└─────────┬───────────┘
          ▼
         DB
```


# FAQ

## Q-1 SQLModel optimize SQLAlchemy（+Pydantic）
